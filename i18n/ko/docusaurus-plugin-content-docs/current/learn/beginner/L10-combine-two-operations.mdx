---
sidebar_position: 10
title: "2개의 작업을 합성"
description: "여러 작업을 하나의 트랜잭션으로 합치기"
---

import BrowserOnly from '@docusaurus/BrowserOnly';
import { PtbBuilderDemo } from '@site/src/components/PtbBuilderDemo';

# 2개의 작업을 합성

이 레슨에서는 PTB Builder를 사용하여 **2개의 송금 작업을 하나의 트랜잭션으로 합치는 PTB를 처음부터 직접 조립**합니다. **어렵지 않습니다**—단계를 따라하면 금방 완성됩니다.

## PTB(Programmable Transaction Block)란?

Sui에서는 여러 작업을 **하나의 트랜잭션**으로 합쳐서 실행할 수 있습니다. 이것을 **PTB(Programmable Transaction Block)**라고 합니다.

PTB를 사용하면 다음과 같은 이점이 있습니다:

- **가스비 절약 (주로 오버헤드)** — 여러 트랜잭션으로 나누는 것보다 서명과 기본 비용을 한 번으로 합칠 수 있습니다
- **원자성(아토믹성)** — 모든 작업이 성공하거나, 모두 실패하거나 둘 중 하나입니다 (중간 상태가 발생하지 않습니다)
- **효율적** — 한 번의 서명으로 여러 작업을 완료할 수 있습니다

:::tip PTB의 이미지
"A에게 1 SUI 송금"과 "B에게 2 SUI 송금"을 따로 실행하면 2번의 서명이 필요하고 가스비도 2번 발생합니다.
PTB로 합치면 1번의 서명, 1번의 가스비로 끝납니다.
:::

---

## 사전 준비

이 레슨을 시작하기 전에 다음 사항이 완료되었는지 확인하세요:

- [Slush 지갑 설치](/docs/getting-started/L01-install-slush) 완료
- [Devnet으로 전환](/docs/getting-started/L02-switch-devnet) 완료
- [Faucet에서 테스트 토큰 받기](/docs/getting-started/L06-get-test-tokens) 완료

---

## PTB Builder로 2개의 송금을 조립하기

아래의 비주얼 에디터는 **빈 상태**입니다. `Start`와 `End` 노드만 있습니다.

왼쪽 상단의 **가이드**를 따라 노드를 추가・연결하여 2개의 송금 작업을 하나의 트랜잭션으로 조립하세요.
먼저, 사이트 헤더 오른쪽 상단의 지갑 아이콘에서 **Slush 지갑을 연결**하세요.

<BrowserOnly>
  {() => <PtbBuilderDemo answerTemplateId="double-transfer" tutorialId="double-transfer" />}
</BrowserOnly>

---

## Explorer에서 확인

트랜잭션 실행 후 Explorer에서 결과를 확인합니다:

1. 표시된 Transaction Digest 옆의 링크를 클릭합니다
2. Suiscan(또는 다른 Explorer)이 열립니다
3. **Transactions** 섹션에서 2개의 TransferObjects 작업이 포함되어 있는지 확인합니다

---

## 연습: TypeScript 코드로 구현해 보기

PTB Builder에는 작성한 PTB를 TypeScript 코드로 내보내는 기능이 있습니다.

1. 빌더 오른쪽 하단의 "**Export**" 버튼(↓ 아이콘)을 클릭합니다
2. `.ptb` 파일로 다운로드됩니다

TypeScript로 동일한 작업을 구현하면 다음과 같습니다:

```typescript
import { Transaction } from '@mysten/sui/transactions';

const tx = new Transaction();

// 첫 번째 송금
const [coin1] = tx.splitCoins(tx.gas, [1_000_000_000]); // 1 SUI
tx.transferObjects([coin1], recipientAddress1);

// 두 번째 송금
const [coin2] = tx.splitCoins(tx.gas, [2_000_000_000]); // 2 SUI
tx.transferObjects([coin2], recipientAddress2);

// 트랜잭션을 실행
const result = await signAndExecuteTransaction({ transaction: tx });
```

이 코드는 다음 레슨에서 자세히 설명합니다. 지금은 "GUI로 만든 것이 코드가 되는구나"라는 것을 확인할 수 있으면 OK입니다.

:::tip
내보내기된 코드는 CLI나 SDK로 작성하는 PTB와 본질적으로 동일한 구조입니다.
:::

---

## 성공 확인

다음을 할 수 있다면 이 레슨은 완료입니다:

- [ ] 빈 PTB Builder에 노드를 추가하여 2개의 송금 PTB를 조립했다
- [ ] gas 노드를 2개의 SplitCoins에 연결했다
- [ ] 하나의 트랜잭션으로 실행했다
- [ ] Explorer에서 2개의 송금 작업이 포함되어 있는지 확인했다

---

## 자주 발생하는 문제

### 지갑이 연결되지 않음

- 브라우저 확장 프로그램의 Slush 지갑이 설치되어 있는지 확인하세요
- 네트워크가 Devnet으로 설정되어 있는지 확인하세요
- [L07: 지갑을 PTB Builder에 연결하기](/docs/learn/beginner/L07-connect-wallet-to-ptb-builder)를 참조하세요

### Execute 버튼을 누를 수 없음

- 지갑이 연결되어 있는지 확인하세요
- 모든 노드가 올바르게 연결되어 있는지 확인하세요
- Start에서 End까지 끊기지 않고 플로우가 연결되어 있어야 합니다

### 트랜잭션이 실패함

- 가스 잔액이 충분한지 확인하세요
- 분할 원본 SUI 코인(gas)의 잔액이 송금 총액 + 가스비를 초과하는지 확인하세요
- 잔액이 부족한 경우 [Faucet](/docs/getting-started/L06-get-test-tokens)에서 추가 SUI를 받으세요

---

## 이 레슨에서 한 일

- [x] PTB(Programmable Transaction Block)의 개념을 이해했습니다
- [x] 빈 PTB Builder에서 노드를 추가・연결하여 2개의 송금 PTB를 조립했습니다
- [x] 하나의 트랜잭션으로 합쳐서 실행했습니다
- [x] Explorer에서 결과를 확인했습니다
- [x] TypeScript 코드 내보내기 기능을 확인했습니다
